/**
 ******************************************************************************
 * @file      udelay.c
 * @brief     本文实现微妙延时函数.
 * @details   This file including all API functions's implement of udelay.c.
 *
 * @copyright
 ******************************************************************************
 */
 
/*-----------------------------------------------------------------------------
 Section: Includes
 ----------------------------------------------------------------------------*/
#include <types.h>
#include <udelay.h>

/*-----------------------------------------------------------------------------
 Section: Type Definitions
 ----------------------------------------------------------------------------*/
/* NONE */

/*-----------------------------------------------------------------------------
 Section: Constant Definitions
 ----------------------------------------------------------------------------*/
/* NONE */ 

/*-----------------------------------------------------------------------------
 Section: Global Variables
 ----------------------------------------------------------------------------*/
/* NONE */

/*-----------------------------------------------------------------------------
 Section: Local Variables
 ----------------------------------------------------------------------------*/
static uint32_t usjiffies = 0u;

/*-----------------------------------------------------------------------------
 Section: Local Function Prototypes
 ----------------------------------------------------------------------------*/
/* NONE */

/*-----------------------------------------------------------------------------
 Section: Function Definitions
 ----------------------------------------------------------------------------*/
/**
 ******************************************************************************
 * @brief   获取微秒计数器的值
 * @param[in]  None
 * @param[out] None
 *
 * @retval
 ******************************************************************************
 */
__INLINE void
os_us_isr(void)
{
    usjiffies++;

}
/**
 ******************************************************************************
 * @brief   获取微秒计数器的值
 * @param[in]  None
 * @param[out] None
 *
 * @retval     微秒计数器的值
 ******************************************************************************
 */
__INLINE uint32_t
get_usjiffies(void)
{
    return usjiffies;
}

/**
 ******************************************************************************
 * @brief   微妙延时
 * @param[in]  us   : 时间(微妙)
 * @retval     None
 *
 * @details
 *  实际为忙等，若需长时间延时请使用taskDelay
 ******************************************************************************
 */
void
_usleep(uint32_t us)
{
    uint32_t time_out = us + usjiffies;
    while (usjiffies < time_out)
    {
        ;   /* 忙等 */
    }
}

/*--------------------------------udelay.c-----------------------------------*/
